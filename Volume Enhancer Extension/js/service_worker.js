class ServiceWorker{constructor(){this.queue=[],this.initListeners(),this.initPopup(),chrome.system.display.getInfo(null,(e=>{this.screen=e[0].bounds})),chrome.tabs.onRemoved.addListener((()=>{this.getCurrentTabId().then((e=>{chrome.action.setBadgeText({text:"",tabId:e})}))}))}initListeners(){chrome.runtime.onInstalled.addListener((function(e){"install"===e.reason&&chrome.tabs.create({url:"https://sound-ultimate.com/api/install/"})})),chrome.runtime.setUninstallURL("https://sound-ultimate.com/uninstall/")}initPopup(){chrome.action.onClicked.addListener((async e=>{if(!e.id)return;const t=await this.getPopupId(e.id);if(t){if(await this.getWindow(t))return chrome.windows.update(t,{focused:!0})}const i=await this.createPopup(e.id);await this.savePopupId(e.id,i)}))}createPopup(e){return new Promise((t=>{let i;i=navigator.platform.includes("Win")?341:327,chrome.windows.create({type:"popup",url:"/window.html?tabId="+e,focused:!0,height:470,width:i,left:this.screen.width-i},(e=>t(e.id)))}))}getPopupId(e){return new Promise((t=>{const i=`popup_${e}`;chrome.storage.local.get([i],(e=>{t(e[i])}))}))}getWindow(e){return new Promise((t=>{chrome.windows.get(e,t)}))}savePopupId(e,t){return new Promise((i=>{const r=`popup_${e}`;chrome.storage.local.set({[r]:t},i)}))}getCurrentTabId(){return new Promise((e=>{chrome.tabs.query({active:!0},(t=>{chrome.runtime.lastError||e(t[0].id)}))}))}}const t=new ServiceWorker;